<html>
  <head><title>textify</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script type="text/javascript">
      var thing;
      function startmeup(){
	  thing = new textify($('body'));
      }
      function grey(r,g,b){
	  return (0.21 * r + 0.72 * g  + 0.07 * b);
      }

      function textify(c){

	  var _t = this;
          _t.draw(c);
      }
      
      textify.prototype={
	  draw:function(container){
              var t = this;
              t.container = container;
              var input = $('<input>').val(t.distance).change(function(){
                  t.distance=this.value;
                  if(''!= t.srcimg[0].src){
                      t.process();
                  }
              });
              
              container.append($('<div>').text("Directions:").append(
                  $('<ul>')
                      .append($('<li>').text("Paste an image to the page"))
                      .append($('<li>').text("Wait -- you're processing an image in Javascript..."))
              ));
              t.srcimg = $('<img>');
              t.srcimg.load(function(){t.process()});
              container.on('paste',function(evt){
                  return(t.handlePaste(evt));
	      });
	      t.process();
          },
          handlePaste : function  (evt) {
              var t = this;
              var items = evt.originalEvent.clipboardData.items, paste;
              for (var i in items){
                  if('file' ==items[i].kind){
                      var fr = new FileReader();
		      console.log("Rec'd Image");
                      fr.onload = function(revt){
                          t.srcimg[0].src = revt.target.result;
                      }
                      fr.readAsDataURL(items[i].getAsFile());
                  }
              }
          },
	  getChar:function(n){
	      var i = n - 32;
	      var canvas = $('<canvas>');
	      var ctx = canvas[0].getContext('2d');
	      var w = canvas[0].width = 8;
	      var h = canvas[0].height= 12;
	      var ox = 5*w + 3;
	      var oy = 1*h + 5;
	      var x = ox + w*(i % 10);
	      var y = oy + h*(Math.floor(i /10));
	      ctx.drawImage($('#chars')[0],ox,oy,w,h,x,y,w,h);
	      return(canvas);
	  },
         
          process:function(){
              var t = this;
	      var canvas = t.getChar(64);
	      var outImg = $('<img>');
	      outImg[0].src =canvas[0].toDataURL();
	      t.container.append(outImg);
	      
	  }
      };

    </script>
    <body onload="startmeup()">
      <img src="chars.png" id='chars' style="display:none;">
    </body>
</html>
